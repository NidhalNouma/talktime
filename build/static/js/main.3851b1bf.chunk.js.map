{"version":3,"sources":["component/WaveAudio.js","hooks/Fire.js","hooks/Stream.js","component/Audio.js","hooks/Call.js","App.js","reportWebVitals.js","index.js"],"names":["WaveAudio","stream","lstream","useState","Wave","wave","lwave","rel","setRel","audio","useRef","useEffect","interval","setTimeout","r","clearTimeout","stopStream","active","fromStream","type","colors","current","srcObject","id","ref","style","display","volume","autoPlay","status","diallingCollection","callCollection","firebase","apps","length","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","firestore","pc","a","doc","collection","set","time","Date","getTime","offerId","answerId","getAllDialling","setData","setCall","onSnapshot","ids","docs","map","filter","i","data","me","find","oId","updateDialling","offerCall","getOffer","then","offer","answerCall","checkStatus","ans","ndata","Math","floor","random","randomSearch","delete","catch","error","console","callId","callDoc","answerCandidates","offerCandidates","onicecandidate","event","candidate","add","toJSON","get","callData","offerDescription","setRemoteDescription","RTCSessionDescription","createAnswer","answerDescription","setLocalDescription","answer","sdp","update","snapshot","docChanges","forEach","change","addIceCandidate","RTCIceCandidate","createOffer","currentRemoteDescription","exists","servers","iceServers","urls","iceCandidatePoolSize","Stream","setLStream","MediaStream","rstream","RTCPeerConnection","navigator","mediaDevices","getUserMedia","getTracks","track","addTrack","err","log","message","ontrack","streams","Audio","setId","setCallId","setIds","uns","removeDialling","stopAudioOnly","color","height","width","readyState","kind","stop","Call","state","setState","btnText","setBtnText","click","App","className","onClick","href","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.3851b1bf.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport Wave from \"wave-visualizer\";\n\nfunction WaveAudio({ stream, lstream }) {\n  const [wave] = useState(new Wave());\n  const [lwave] = useState(new Wave());\n  const [rel, setRel] = useState(0);\n\n  const audio = useRef(null);\n\n  useEffect(() => {\n    const interval = setTimeout(() => {\n      setRel((r) => r + 1);\n      // console.log(rel);\n    }, 1000);\n    return () => clearTimeout(interval);\n  }, [rel]);\n\n  useEffect(() => {\n    wave.stopStream();\n    lwave.stopStream();\n    if (stream)\n      if (stream.active)\n        wave.fromStream(stream, \"wave\", {\n          type: \"shine\",\n          colors: [\"rgba(149, 54, 64,1)\", \"white\", \"blue\"],\n        });\n\n    lstream &&\n      lstream.active &&\n      lwave.fromStream(lstream, \"lwave\", {\n        type: \"shine\",\n        colors: [\"rgba(45, 134, 233, 1)\", \"white\", \"blue\"],\n      });\n\n    // console.log(\"Start streaming audio ...\");\n\n    audio.current.srcObject = stream;\n    return () => {\n      wave.stopStream();\n      lwave.stopStream();\n    };\n  }, [lstream, stream, rel]);\n\n  return (\n    <div>\n      <canvas id=\"wave\"></canvas>\n      <br />\n      <canvas id=\"lwave\"></canvas>\n      <audio\n        ref={audio}\n        style={{ display: \"none\" }}\n        volume=\"true\"\n        autoPlay\n      ></audio>\n    </div>\n  );\n}\n\nexport default WaveAudio;\n","import firebase from \"firebase/app\";\nimport \"firebase/firestore\";\n\nconst firebaseConfig = {\n  apiKey: \"AIzaSyApGSMWbFNPmUZKk4RQDmZYCBqlB5B69Xk\",\n  authDomain: \"talktime-57dc9.firebaseapp.com\",\n  projectId: \"talktime-57dc9\",\n  storageBucket: \"talktime-57dc9.appspot.com\",\n  messagingSenderId: \"907184166513\",\n  appId: \"1:907184166513:web:5b7cd711a736d985aaadd0\",\n  measurementId: \"G-6049KZ3QMC\",\n};\n\nconst status = {\n  waiting: \"waiting\",\n  offerCall: \"offerCall\",\n  reciveOffer: \"reciveOffer\",\n  confirmOffer: \"confirmOffer\",\n  call: \"call\",\n  answer: \"answer\",\n};\n\nconst diallingCollection = \"dialling\";\nconst callCollection = \"call\";\n\nif (!firebase.apps.length) {\n  firebase.initializeApp(firebaseConfig);\n}\nconst firestore = firebase.firestore();\n\nexport async function createOffer(pc) {\n  // Reference Firestore collections for signaling\n  const doc = firestore.collection(diallingCollection).doc();\n  const id = doc.id;\n\n  doc.set({\n    status: status.waiting,\n    time: new Date().getTime(),\n    offerId: id,\n    answerId: null,\n  });\n\n  return id;\n}\n\nexport function getAllDialling(pc, id, setData, setCall) {\n  return firestore.collection(diallingCollection).onSnapshot((doc) => {\n    const ids = doc.docs.map((doc) => doc.id).filter((i) => i !== id);\n    const data = doc.docs.map((doc) => doc.data());\n    setData(ids);\n\n    checkStatus(id, data, setCall, pc);\n\n    const ans = randomSearch(id, data);\n    if (ans) {\n      updateDialling(id, {\n        status: status.offerCall,\n        answerId: ans.offerId,\n      });\n      updateDialling(ans.offerId, {\n        status: status.reciveOffer,\n        answerId: id,\n      });\n    }\n  });\n}\n\nexport async function removeDialling(id) {\n  firestore\n    .collection(diallingCollection)\n    .doc(id)\n    .delete()\n    .then(() => {\n      // console.log(\"Document successfully deleted!\");\n    })\n    .catch((error) => {\n      console.error(\"Error removing document: \", error);\n    });\n}\n\nexport async function answerCall(id, pc) {\n  const callId = id;\n  const callDoc = firestore.collection(callCollection).doc(callId);\n  const answerCandidates = callDoc.collection(\"answerCandidates\");\n  const offerCandidates = callDoc.collection(\"offerCandidates\");\n\n  pc.onicecandidate = (event) => {\n    event.candidate && answerCandidates.add(event.candidate.toJSON());\n  };\n\n  const callData = (await callDoc.get()).data();\n\n  const offerDescription = callData.offer;\n  await pc.setRemoteDescription(new RTCSessionDescription(offerDescription));\n\n  const answerDescription = await pc.createAnswer();\n  await pc.setLocalDescription(answerDescription);\n\n  const answer = {\n    type: answerDescription.type,\n    sdp: answerDescription.sdp,\n  };\n\n  await callDoc.update({ answer });\n\n  offerCandidates.onSnapshot((snapshot) => {\n    snapshot.docChanges().forEach((change) => {\n      if (change.type === \"added\") {\n        let data = change.doc.data();\n        pc.addIceCandidate(new RTCIceCandidate(data));\n      }\n    });\n  });\n}\n\nexport async function offerCall(pc, id) {\n  // Reference Firestore collections for signaling\n  const callDoc = firestore.collection(callCollection).doc(id);\n  const offerCandidates = callDoc.collection(\"offerCandidates\");\n  const answerCandidates = callDoc.collection(\"answerCandidates\");\n\n  // Get candidates for caller, save to db\n  pc.onicecandidate = (event) => {\n    event.candidate && offerCandidates.add(event.candidate.toJSON());\n  };\n\n  // Create offer\n  const offerDescription = await pc.createOffer();\n  await pc.setLocalDescription(offerDescription);\n\n  const offer = {\n    sdp: offerDescription.sdp,\n    type: offerDescription.type,\n  };\n\n  await callDoc.set({ offer });\n\n  // Listen for remote answer\n  callDoc.onSnapshot((snapshot) => {\n    const data = snapshot.data();\n    if (!pc.currentRemoteDescription && data?.answer) {\n      const answerDescription = new RTCSessionDescription(data.answer);\n      pc.setRemoteDescription(answerDescription);\n    }\n  });\n\n  // When answered, add candidate to peer connection\n  answerCandidates.onSnapshot((snapshot) => {\n    snapshot.docChanges().forEach((change) => {\n      if (change.type === \"added\") {\n        const candidate = new RTCIceCandidate(change.doc.data());\n        pc.addIceCandidate(candidate);\n      }\n    });\n  });\n\n  return callDoc.id;\n}\n\nfunction randomSearch(id, data) {\n  if (id && data && data.length > 1) {\n    const me = data.find((i) => i.offerId === id);\n    const time = me.time;\n    const ndata = data.filter(\n      (i) => i.time > time && i.offerId !== id && i.status === \"waiting\"\n    );\n\n    const random = Math.floor(Math.random() * ndata.length);\n    // console.log(ndata, random);\n    return ndata[random];\n  }\n\n  return null;\n}\n\nfunction checkStatus(id, data, setCall, pc) {\n  if (id && data && data.length > 1) {\n    const me = data.find((i) => i.offerId === id);\n    let oId = null;\n    if (me.answerId !== null) oId = data.find((i) => i.offerId === me.answerId);\n\n    if (me.status === status.reciveOffer) {\n      updateDialling(id, { status: status.confirmOffer });\n    } else if (me.status === status.offerCall) {\n      offerCall(pc, me.offerId);\n    }\n    if (\n      me.status === status.offerCall &&\n      oId &&\n      oId.status === status.confirmOffer\n    ) {\n      setCall(me.offerId);\n    }\n    if (me.status === status.confirmOffer) {\n      getOffer(me.answerId).then((offer) => {\n        // console.log(offer, me.answerId);\n        if (offer) {\n          answerCall(me.answerId, pc);\n          setCall(me.answerId);\n        }\n      });\n    }\n  }\n}\n\nfunction updateDialling(id, data) {\n  firestore\n    .collection(diallingCollection)\n    .doc(id)\n    .update(data)\n    .then(() => {\n      // console.log(\"Document successfully updated!\");\n    })\n    .catch((error) => {\n      // The document probably doesn't exist.\n      console.error(\"Error updating document: \", error);\n    });\n}\n\nasync function getOffer(id) {\n  const doc = await firestore.collection(callCollection).doc(id).get();\n  if (doc.exists) {\n    return doc.data();\n  }\n  return null;\n}\n\nasync function getStatus(id) {\n  const doc = await firestore.collection(diallingCollection).doc(id).get();\n  if (doc.exists) {\n    return doc.data();\n  }\n  return null;\n}\n","import { useState, useEffect } from \"react\";\n\nconst servers = {\n  iceServers: [\n    {\n      urls: [\n        \"stun:stun.l.google.com:19305\",\n        \"stun:stun1.l.google.com:19305\",\n        \"stun:stun2.l.google.com:19305\",\n        \"stun:stun3.l.google.com:19305\",\n        \"stun:stun4.l.google.com:19305\",\n        \"stun:stun.services.mozilla.com\",\n      ],\n    },\n  ],\n  iceCandidatePoolSize: 10,\n};\n\nfunction Stream(type) {\n  const [lstream, setLStream] = useState(null);\n  const [rstream] = useState(new MediaStream());\n  const [pc] = useState(new RTCPeerConnection(servers));\n\n  useEffect(() => {\n    if (type !== 1) return;\n    navigator.mediaDevices\n      .getUserMedia({\n        audio: true,\n      })\n      .then(function (stream) {\n        // if (lstream) return;\n        // Push tracks from local stream to peer connection\n        stream.getTracks().forEach((track) => {\n          pc.addTrack(track, stream);\n        });\n        setLStream(stream);\n      })\n      .catch(function (err) {\n        console.log(err.message);\n      });\n\n    // Pull tracks from remote stream, add to video stream\n    pc.ontrack = (event) => {\n      event.streams[0].getTracks().forEach((track) => {\n        rstream.addTrack(track);\n      });\n    };\n  }, [type]);\n\n  return { lstream, rstream, pc };\n}\n\nexport default Stream;\n","import React, { useEffect, useState, useRef } from \"react\";\nimport Loader from \"react-loader-spinner\";\nimport WaveAudio from \"./WaveAudio\";\nimport { createOffer, getAllDialling, removeDialling } from \"../hooks/Fire\";\n\nimport Stream from \"../hooks/Stream\";\n\nfunction Audio({ type = 0, answer }) {\n  const { lstream, rstream, pc } = Stream(type);\n  const [id, setId] = useState(null);\n  const [callId, setCallId] = useState(null);\n  const [ids, setIds] = useState([]);\n  let uns = useRef(null);\n\n  useEffect(() => {\n    if (type === 1) {\n      createOffer(pc).then((i) => {\n        setId(i);\n        uns.current = getAllDialling(pc, i, setIds, setCallId);\n      });\n    } else if (id !== null) {\n      removeDialling(id);\n      setId(null);\n      uns.current();\n    }\n\n    if (type !== 2) {\n      setCallId(null);\n      stopAudioOnly(lstream);\n      stopAudioOnly(rstream);\n    }\n  }, [type]);\n\n  useEffect(() => {\n    if (callId) answer();\n  }, [callId, answer]);\n\n  return type === 1 ? (\n    <Loader\n      type=\"ThreeDots\"\n      color=\"rgba(102, 193, 113, 1)\"\n      height={100}\n      width={100}\n    />\n  ) : type === 2 ? (\n    <WaveAudio stream={rstream} lstream={lstream} />\n  ) : (\n    <></>\n  );\n}\n\nexport default Audio;\n\nfunction stopAudioOnly(stream) {\n  stream?.getTracks().forEach(function (track) {\n    if (track.readyState === \"live\" && track.kind === \"audio\") {\n      track.stop();\n    }\n  });\n}\n","import { useState } from \"react\";\n\nfunction Call() {\n  const [state, setState] = useState(0);\n  const [btnText, setBtnText] = useState(\"Call\");\n\n  const click = function () {\n    state === 0 && (setState(1) || setBtnText(\"Dialling\"));\n    state === 1 && (setState(0) || setBtnText(\"Call\"));\n    state === 2 && (setState(0) || setBtnText(\"Call\"));\n  };\n\n  const answer = function () {\n    state === 1 && (setState(2) || setBtnText(\"End\"));\n  };\n\n  return { state, click, btnText, answer };\n}\n\nexport default Call;\n","import Audio from \"./component/Audio\";\nimport Call from \"./hooks/Call\";\n\nfunction App() {\n  const { state, click, btnText, answer } = Call();\n\n  return (\n    <div className=\"App\">\n      <div className=\"logo\">\n        <h4>TalkTime</h4>\n      </div>\n      <div>\n        <h5>Find someone to talk to.</h5>\n      </div>\n      <div className=\"audio-animation\">\n        <Audio type={state} answer={answer} />\n      </div>\n      <div className=\"button\">\n        <button onClick={click} className={btnText}>\n          {btnText}\n        </button>\n      </div>\n      <div className=\"footer\">\n        <a href=\"/privacy\">Privacy Policy</a> | <a href=\"/terms\">Terms</a>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}