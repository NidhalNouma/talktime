(this.webpackJsonptalktime=this.webpackJsonptalktime||[]).push([[0],{24:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var a=n(2),c=n.n(a),r=n(18),o=n.n(r),s=(n(24),n(7)),i=n(19),u=n.n(i),d=n(15),l=n.n(d),f=n(3);var p=function(e){var t=e.stream,n=e.lstream,c=Object(a.useState)(new l.a),r=Object(s.a)(c,1)[0],o=Object(a.useState)(new l.a),i=Object(s.a)(o,1)[0],u=Object(a.useState)(0),d=Object(s.a)(u,2),p=d[0],j=d[1],b=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=setTimeout((function(){j((function(e){return e+1}))}),1e3);return function(){return clearTimeout(e)}}),[p]),Object(a.useEffect)((function(){return r.stopStream(),i.stopStream(),t&&t.active&&r.fromStream(t,"wave",{type:"shine",colors:["rgba(149, 54, 64,1)","white","blue"]}),n&&n.active&&i.fromStream(n,"lwave",{type:"shine",colors:["rgba(45, 134, 233, 1)","white","blue"]}),b.current.srcObject=t,function(){r.stopStream(),i.stopStream()}}),[n,t,p]),Object(f.jsxs)("div",{children:[Object(f.jsx)("canvas",{id:"wave"}),Object(f.jsx)("br",{}),Object(f.jsx)("canvas",{id:"lwave"}),Object(f.jsx)("audio",{ref:b,style:{display:"none"},volume:"true",autoPlay:!0})]})},j=n(8),b=n.n(j),m=n(12),h=n(13),O=(n(52),"waiting"),v="offerCall",w="reciveOffer",g="confirmOffer",x="dialling",S="call";h.a.apps.length||h.a.initializeApp({apiKey:"AIzaSyApGSMWbFNPmUZKk4RQDmZYCBqlB5B69Xk",authDomain:"talktime-57dc9.firebaseapp.com",projectId:"talktime-57dc9",storageBucket:"talktime-57dc9.appspot.com",messagingSenderId:"907184166513",appId:"1:907184166513:web:5b7cd711a736d985aaadd0",measurementId:"G-6049KZ3QMC"});var y=h.a.firestore();function k(){return(k=Object(m.a)(b.a.mark((function e(t){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.collection(x).doc(),a=n.id,n.set({status:O,time:(new Date).getTime(),offerId:a,answerId:null}),e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t,n,a){return y.collection(x).onSnapshot((function(c){var r=c.docs.map((function(e){return e.id})).filter((function(e){return e!==t})),o=c.docs.map((function(e){return e.data()}));n(r),function(e,t,n,a){if(e&&t&&t.length>1){var c=t.find((function(t){return t.offerId===e})),r=null;null!==c.answerId&&(r=t.find((function(e){return e.offerId===c.answerId}))),c.status===w?E(e,{status:g}):c.status===v&&function(e,t){D.apply(this,arguments)}(a,c.offerId),c.status===v&&r&&r.status===g&&n(c.offerId),c.status===g&&function(e){return R.apply(this,arguments)}(c.answerId).then((function(e){e&&(!function(e,t){T.apply(this,arguments)}(c.answerId,a),n(c.answerId))}))}}(t,o,a,e);var s=function(e,t){if(e&&t&&t.length>1){var n=t.find((function(t){return t.offerId===e})).time,a=t.filter((function(t){return t.time>n&&t.offerId!==e&&"waiting"===t.status}));return a[Math.floor(Math.random()*a.length)]}return null}(t,o);s&&(E(t,{status:v,answerId:s.offerId}),E(s.offerId,{status:w,answerId:t}))}))}function C(){return(C=Object(m.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:y.collection(x).doc(t).delete().then((function(){})).catch((function(e){console.error("Error removing document: ",e)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return(T=Object(m.a)(b.a.mark((function e(t,n){var a,c,r,o,s,i,u,d;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,c=y.collection(S).doc(a),r=c.collection("answerCandidates"),o=c.collection("offerCandidates"),n.onicecandidate=function(e){e.candidate&&r.add(e.candidate.toJSON())},e.next=7,c.get();case 7:return s=e.sent.data(),i=s.offer,e.next=11,n.setRemoteDescription(new RTCSessionDescription(i));case 11:return e.next=13,n.createAnswer();case 13:return u=e.sent,e.next=16,n.setLocalDescription(u);case 16:return d={type:u.type,sdp:u.sdp},e.next=19,c.update({answer:d});case 19:o.onSnapshot((function(e){e.docChanges().forEach((function(e){if("added"===e.type){var t=e.doc.data();n.addIceCandidate(new RTCIceCandidate(t))}}))}));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=Object(m.a)(b.a.mark((function e(t,n){var a,c,r,o,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=y.collection(S).doc(n),c=a.collection("offerCandidates"),r=a.collection("answerCandidates"),t.onicecandidate=function(e){e.candidate&&c.add(e.candidate.toJSON())},e.next=6,t.createOffer();case 6:return o=e.sent,e.next=9,t.setLocalDescription(o);case 9:return s={sdp:o.sdp,type:o.type},e.next=12,a.set({offer:s});case 12:return a.onSnapshot((function(e){var n=e.data();if(!t.currentRemoteDescription&&(null===n||void 0===n?void 0:n.answer)){var a=new RTCSessionDescription(n.answer);t.setRemoteDescription(a)}})),r.onSnapshot((function(e){e.docChanges().forEach((function(e){if("added"===e.type){var n=new RTCIceCandidate(e.doc.data());t.addIceCandidate(n)}}))})),e.abrupt("return",a.id);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t){y.collection(x).doc(e).update(t).then((function(){})).catch((function(e){console.error("Error updating document: ",e)}))}function R(){return(R=Object(m.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.collection(S).doc(t).get();case 2:if(!(n=e.sent).exists){e.next=5;break}return e.abrupt("return",n.data());case 5:return e.abrupt("return",null);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N={iceServers:[{urls:["stun:stun.l.google.com:19305","stun:stun1.l.google.com:19305","stun:stun2.l.google.com:19305","stun:stun3.l.google.com:19305","stun:stun4.l.google.com:19305","stun:stun.services.mozilla.com"]}],iceCandidatePoolSize:10};var P=function(e){var t=Object(a.useState)(null),n=Object(s.a)(t,2),c=n[0],r=n[1],o=Object(a.useState)(new MediaStream),i=Object(s.a)(o,1)[0],u=Object(a.useState)(new RTCPeerConnection(N)),d=Object(s.a)(u,1)[0];return Object(a.useEffect)((function(){1===e&&(navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){e.getTracks().forEach((function(t){d.addTrack(t,e)})),r(e)})).catch((function(e){console.log(e.message)})),d.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){i.addTrack(e)}))})}),[e]),{lstream:c,rstream:i,pc:d}};var F=function(e){var t=e.type,n=void 0===t?0:t,c=e.answer,r=P(n),o=r.lstream,i=r.rstream,d=r.pc,l=Object(a.useState)(null),j=Object(s.a)(l,2),b=j[0],m=j[1],h=Object(a.useState)(null),O=Object(s.a)(h,2),v=O[0],w=O[1],g=Object(a.useState)([]),x=Object(s.a)(g,2),S=(x[0],x[1]),y=Object(a.useRef)(null);return Object(a.useEffect)((function(){1===n?function(e){return k.apply(this,arguments)}(d).then((function(e){m(e),y.current=I(d,e,S,w)})):null!==b&&(!function(e){C.apply(this,arguments)}(b),m(null),y.current()),2!==n&&(w(null),M(o),M(i))}),[n]),Object(a.useEffect)((function(){v&&c()}),[v,c]),1===n?Object(f.jsx)(u.a,{type:"ThreeDots",color:"rgba(102, 193, 113, 1)",height:100,width:100}):2===n?Object(f.jsx)(p,{stream:i,lstream:o}):Object(f.jsx)(f.Fragment,{})};function M(e){null===e||void 0===e||e.getTracks().forEach((function(e){"live"===e.readyState&&"audio"===e.kind&&e.stop()}))}var B=function(){var e=Object(a.useState)(0),t=Object(s.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)("Call"),o=Object(s.a)(r,2),i=o[0],u=o[1];return{state:n,click:function(){0===n&&(c(1)||u("Dialling")),1===n&&(c(0)||u("Call")),2===n&&(c(0)||u("Call"))},btnText:i,answer:function(){1===n&&(c(2)||u("End"))}}};var A=function(){var e=B(),t=e.state,n=e.click,a=e.btnText,c=e.answer;return Object(f.jsxs)("div",{className:"App",children:[Object(f.jsx)("div",{className:"logo",children:Object(f.jsx)("h4",{children:"TalkTime"})}),Object(f.jsx)("div",{children:Object(f.jsx)("h5",{children:"Find someone to talk to."})}),Object(f.jsx)("div",{className:"audio-animation",children:Object(f.jsx)(F,{type:t,answer:c})}),Object(f.jsx)("div",{className:"button",children:Object(f.jsx)("button",{onClick:n,className:a,children:a})}),Object(f.jsxs)("div",{className:"footer",children:[Object(f.jsx)("a",{href:"/privacy",children:"Privacy Policy"})," | ",Object(f.jsx)("a",{href:"/terms",children:"Terms"})]})]})},z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,53)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))};o.a.render(Object(f.jsx)(c.a.StrictMode,{children:Object(f.jsx)(A,{})}),document.getElementById("root")),z()}},[[51,1,2]]]);
//# sourceMappingURL=main.3851b1bf.chunk.js.map